{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://echo.local/schemas/ebscm_metric_definition.schema.json",
  "title": "EBSCM Metric Definition",
  "type": "object",
  "required": [
    "metric_id",
    "name",
    "category",
    "domain",
    "unit",
    "calculation",
    "owner_authority",
    "collection_cadence",
    "lifecycle_status",
    "disclosure_class",
    "sources"
  ],
  "properties": {
    "metric_id": {
      "type": "string",
      "pattern": "^[a-z0-9_\-]{4,64}$"
    },
    "name": {"type": "string"},
    "description": {"type": "string"},
    "category": {
      "type": "string",
      "enum": ["financial", "operational", "social", "environmental", "institutional"]
    },
    "domain": {"type": "string"},
    "unit": {"type": "string"},
    "metric_type": {
      "type": "string",
      "enum": ["count", "rate", "ratio", "index", "score", "currency", "duration"]
    },
    "calculation": {"type": "string"},
    "owner_authority": {
      "type": "string",
      "enum": ["EBSCM"]
    },
    "collection_cadence": {
      "type": "string",
      "enum": ["real_time", "hourly", "daily", "weekly", "monthly", "quarterly", "annual", "event_driven"]
    },
    "lifecycle_status": {
      "type": "string",
      "enum": ["draft", "active", "provisional", "revised", "deprecated"]
    },
    "disclosure_class": {
      "type": "string",
      "enum": ["public", "restricted", "sealed"]
    },
    "confidence": {
      "type": "object",
      "properties": {
        "level": {"type": "number", "minimum": 0, "maximum": 1},
        "margin_of_error": {"type": "number", "minimum": 0}
      },
      "required": ["level"]
    },
    "sampling": {
      "type": "object",
      "properties": {
        "frame": {"type": "string"},
        "coverage_pct": {"type": "number", "minimum": 0, "maximum": 100},
        "method": {"type": "string"}
      }
    },
    "sources": {
      "type": "array",
      "minItems": 1,
      "items": {"$ref": "#/definitions/source_binding"}
    },
    "revision_policy": {"type": "string"},
    "revision_of": {"type": "string"},
    "tags": {"type": "array", "items": {"type": "string"}}
  },
  "definitions": {
    "source_binding": {
      "type": "object",
      "required": ["system", "dataset", "edcsa_event_ref", "provenance_hash"],
      "properties": {
        "system": {"type": "string"},
        "dataset": {"type": "string"},
        "edcsa_event_ref": {"type": "string"},
        "consent_scope": {"type": "string"},
        "provenance_hash": {"type": "string"},
        "steward": {"type": "string"},
        "extracted_at": {"type": "string", "format": "date-time"}
      }
    }
  }
}
